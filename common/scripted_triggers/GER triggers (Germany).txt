# use this in state scope
is_french_colonial_claim = {
	has_state_flag = french_colonial_claim
}

# use this in state scope
is_portuguese_colonial_claim = {
	OR = {
		is_core_of = ANG
		is_core_of = MZB
		state = 296 #Bulama
		state = 321 #Goa
		state = 702 #Cape Verde
		state = 705 #São Tomé
		state = 721 #East Timor
		state = 729 #Macao
	}
}

# use this in state scope
is_british_colonial_claim = {
	has_state_flag = british_colonial_claim
}

# use this in state scope
is_owned_by_GER_or_MAF = {
	owner = {
		OR = {
			tag = GER
			tag = MAF
			is_subject_of = MAF
		}
	}
}

# use this in state scope
african_state_can_be_taken = {
	NOT = {
		state = 879 #Katanga
		state = 977 #Kivu
		state = 718 #Welle
		state = 949 #Maniema
		state = 976 #Kasai
		state = 295 #Kinshasa
		state = 538 #Tshuapa
		state = 1026 #Haut-Congo
		state = 974 #Ubangi
		state = 927 #Douala
		state = 952 #Adamawa
		state = 971 #New Cameroon
		state = 962 #Maroua
		state = 1096 #Yaounde
		state = 546 #Dodoma
		state = 899 #Ruvuma
		state = 1032 #Tabora
		state = 965 #Dar-es-Salaam
		state = 905 #Zanzibar
		state = 870 #Urundi
		state = 918 #Bukoba
		state = 869 #Rwanda
		state = 548 #Uganda
	}
}

GER_has_black_monday = {
	custom_trigger_tooltip = {
		tooltip = GER_has_black_monday
		OR = {
			has_idea = GER_black_monday_2
			has_idea = GER_black_monday_3
			has_idea = GER_black_monday_4
			has_idea = GER_black_monday_5
			has_idea = GER_black_monday_6
			has_idea = GER_black_monday_7
			has_idea = GER_black_monday_8
			has_idea = GER_black_monday_9
			has_idea = GER_black_monday_10
		}
	}
}

GER_is_in_mitteleuropa = {
	has_dynamic_modifier = { modifier = MIT_mitteleuropa_modifier }
}

is_GER_or_ally = {
	custom_trigger_tooltip = {
		tooltip = is_GER_or_ally_tt
		is_ally_with = GER
	}
}

is_controlled_by_GER_or_ally = {
	custom_trigger_tooltip = {
		tooltip = is_controlled_by_GER_or_ally_tt
		controller = {
			is_ally_with = GER
		}
	}
}

is_owned_by_GER_or_ally = {
	custom_trigger_tooltip = {
		tooltip = is_owned_by_GER_or_ally_tt
		owner = {
			is_ally_with = GER
		}
	}
}
GER_is_possible_reichstag_target = {
	NOT = {
		is_in_array = { GER.swr_coalition_members_array = THIS }
		is_in_array = { GER.democratic_union_members_array = THIS }
		has_state_flag = GER_faction_protected_temporarily
		has_state_flag = GER_faction_protected_permanently
	}
}

GER_bm_cardgame_effects_calculate = {

	GER_bm_cardgame_basic_stats_calculate = yes

	if = { #This is for complex cards that might do more funny things... Will overwrite "basic effects". Put line calculation math here if you like, too!
		limit = {
			var:GER_card_played = {
				has_character_flag = custom_card_calculations
			}
		}
		meta_trigger = {
			text = {
				[CARD]_calculate = yes
			}
			CARD = "[?GER_card_played:card_id.GetTokenKey]"
		}
	}
}

GER_bm_cardgame_basic_stats_calculate = {
	var:GER_card_played = {
		if = {
			limit = {
				has_variable = card_investment_value
			}

			set_temp_variable = { GER_investment_effect = card_investment_value }
			set_temp_variable = { investment_multiplier = GER.GER_investment_bonus_factor }
			add_to_temp_variable = { stability_multiplier = GER.GER_investment_perm_bonus_factor }
			multiply_temp_variable = { GER_investment_effect = investment_multiplier }
		}
		if = {
			limit = {
				has_variable = card_stability_value
			}

			set_temp_variable = { GER_stability_effect = card_stability_value }
			set_temp_variable = { stability_multiplier = GER.GER_stability_bonus_factor }
			add_to_temp_variable = { stability_multiplier = GER.GER_stability_perm_bonus_factor }
			multiply_temp_variable = { GER_stability_effect = stability_multiplier }
		}
		if = {
			limit = {
				has_variable = card_draw_value
			}
			set_temp_variable = { GER_cards_to_draw = card_draw_value }
		}
		if = {
			limit = {
				has_variable = card_draw_from_discard
			}
			set_temp_variable = { GER_cards_to_draw_from_discard = card_draw_from_discard }
		}
		if = {
			limit = {
				has_variable = card_debt_value
			}
			set_temp_variable = { GER_debt_effect = card_debt_value }
		}
	}

	if = {
		limit = {
			check_variable = { GER_crisis_id = GER_card_played:GER_card_type }
		}

		multiply_temp_variable = { GER_investment_effect = 1.5 }
		multiply_temp_variable = { GER_stability_effect = 1.5 }
		set_temp_variable = { GER_bm_cardgame_line_number_extra = GER_card_played:card_lines_for_tt_extra }
	}
}

GER_bm_cardgame_fireside_chat_calculate = {

	if = {
		limit = {
			has_country_flag = GER_played_reform_card_this_turn
		}
		set_temp_variable = { extra_lines_for_tt = 1 }
	}
}

GER_bm_cardgame_eastern_assistance_calculate = {

	set_temp_variable = { GER_number_of_mee_countries = 0 }
	if = {
		limit = {
			BAT = {
				GER_is_in_mitteleuropa = yes
			}
		}
		add_to_temp_variable = { GER_number_of_mee_countries = 1 }
	}
	if = {
		limit = {
			LIT = {
				GER_is_in_mitteleuropa = yes
			}
		}
		add_to_temp_variable = { GER_number_of_mee_countries = 1 }
	}
	if = {
		limit = {
			POL = {
				GER_is_in_mitteleuropa = yes
			}
		}
		add_to_temp_variable = { GER_number_of_mee_countries = 1 }
	}
	if = {
		limit = {
			WHR = {
				GER_is_in_mitteleuropa = yes
			}
		}
		add_to_temp_variable = { GER_number_of_mee_countries = 1 }
	}
	if = {
		limit = {
			UKR = {
				GER_is_in_mitteleuropa = yes
			}
		}
		add_to_temp_variable = { GER_number_of_mee_countries = 1 }
	}
	if = {
		limit = {
			EST = {
				GER_is_in_mitteleuropa = yes
			}
		}
		add_to_temp_variable = { GER_number_of_mee_countries = 1 }
	}
	if = {
		limit = {
			FIN = {
				GER_is_in_mitteleuropa = yes
			}
		}
		add_to_temp_variable = { GER_number_of_mee_countries = 1 }
	}
	if = {
		limit = {
			GEO = {
				GER_is_in_mitteleuropa = yes
			}
		}
		add_to_temp_variable = { GER_number_of_mee_countries = 1 }
	}

	set_temp_variable = { GER_investment_effect = GER_card_played:card_investment_value }
	multiply_temp_variable = { GER_investment_effect = GER_number_of_mee_countries }
	multiply_temp_variable = { GER_investment_effect = GER_investment_bonus_factor?1 }
	multiply_temp_variable = { GER_investment_effect = GER_investment_perm_bonus_factor?1 }

	set_temp_variable = { GER_stability_effect = GER_card_played:card_stability_value }
	multiply_temp_variable = { GER_stability_effect = GER_number_of_mee_countries }
	multiply_temp_variable = { GER_stability_effect = GER_stability_bonus_factor?1 }
	multiply_temp_variable = { GER_stability_effect = GER_stability_perm_bonus_factor?1 }
}

GER_bm_cardgame_rathenauplan_calculate = {

	set_temp_variable = { GER_cards_to_draw = GER_rathenauplan_draw }
}

GER_bm_cardgame_tbplan_calculate = {

	set_temp_variable = { GER_cards_to_draw = GER_tbplan_draw }
}

GER_bm_cardgame_corporate_assistance_calculate = {
	if = {
		limit = {
			check_variable = { GER_bm_cardgame_discard_array^num < GER_cards_to_draw_from_discard }
		}

		add_to_temp_variable = { extra_lines_for_tt = 2 }
	}
}

GER_bm_trade_union_collaboration_calculate = {
	set_temp_variable = { GER_trade_union_dealt = GER_investment }
	multiply_temp_variable = { GER_trade_union_dealt = 0.5 }

	set_temp_variable = { GER_stability_effect = GER_trade_union_dealt }
}

build_bm_total_cards = {
	all_of = {
		array = GER_bm_cardgame_cards_array

		meta_trigger = {
			text = {
				add_to_temp_variable = { [GER_CARD_ID]_total_cards = 1 }
			}

			GER_CARD_ID = "[?v.GetTokenKey]"
		}
	}
}

build_bm_hand_cards = {
	all_of = {
		array = GER_bm_cardgame_cards_drawn_array

		meta_trigger = {
			text = {
				add_to_temp_variable = { [GER_CARD_ID]_total_cards = 1 }
			}

			GER_CARD_ID = "[?v.GetTokenKey]"
		}
	}
}
GER_is_schleicher_path = {
	custom_trigger_tooltip = {
		tooltip = GER_is_schleicher_path_tt
		OR = {
			GER_kurt_von_schleicher = { is_second_in_command = yes }
			GER_carl_friedrich_goerdeler = { is_second_in_command = yes }
			GER_ferdinand_von_bredow = { is_second_in_command = yes }
			GER_tilo_wilmowsky = { is_second_in_command = yes }
			GER_august_winnig = { is_second_in_command = yes }
			has_country_flag = GER_bauer_putsch
			has_country_flag = GER_schleicher_path_goes_to_democracy
		}
	}
}
GER_is_swr_path = {
	custom_trigger_tooltip = {
		tooltip = GER_is_swr_path_tt
		OR = {
			has_government = authoritarian_democrat
			has_government = paternal_autocrat
			has_country_flag = GER_swr_path_goes_to_democracy
		}
		GER_kurt_von_schleicher = { is_second_in_command = no }
		GER_carl_friedrich_goerdeler = { is_second_in_command = no }
		GER_ferdinand_von_bredow = { is_second_in_command = no }
		GER_tilo_wilmowsky = { is_second_in_command = no }
		GER_august_winnig = { is_second_in_command = no }
		NOT = { has_country_flag = GER_bauer_putsch }
		NOT = { has_country_flag = GER_schleicher_path_goes_to_democracy }
	}
}
GER_is_du_path = {
	custom_trigger_tooltip = {
		tooltip = GER_is_du_path_tt
		OR = {
			has_government = social_democrat
			has_government = social_liberal
			has_government = market_liberal
			AND = {
				has_government = social_conservative
				has_completed_focus = GER_von_schleicher_cabinet
			}
		}
		NOT = { has_country_flag = GER_swr_path_goes_to_democracy }
		NOT = { has_country_flag = GER_schleicher_path_goes_to_democracy }
	}
}

GER_dont_spend_PP_industry = { #Used for industrial decisions
	NOT = { has_completed_focus = GER_pax_germanica }
	has_political_power < 250
	if = {
		limit = { check_variable = { GER_completed_industrial_decisions < 5 } }
		always = no
	}
	else = {
		OR = {
			has_idea = civilian_economy
			has_idea = volunteer_only
		}
	}
}

GER_dont_spend_PP_decision = {
	NOT = { has_completed_focus = GER_pax_germanica }
	has_political_power < 250
	OR = {
		check_variable = { GER_completed_industrial_decisions < 5 }
		has_idea = civilian_economy
		has_idea = volunteer_only
	}
}

GER_is_prussian_state = {
	OR = {
		state = 188
		state = 5
		state = 777
		state = 776
		state = 86
		state = 66
		state = 67
		state = 68
		state = 63
		state = 62
		state = 64
		state = 147
		state = 58
		state = 59
		state = 782
		state = 56
		state = 57
		state = 55
		state = 51
		state = 781 # All states of the Kingdom of Prussia
	}
}

is_germany_or_german_colonial_tag = {
	OR = {
		original_tag = GER
		original_tag = GRU
		original_tag = MAF
		original_tag = GEA
	}
}

is_country_in_faction_hostile_to_germany = {
	OR = {
		is_in_faction_with = INT
		is_in_faction_with = BPL
		AND = {
			is_in_faction = yes
			faction_leader = {
				OR = {
					original_tag = JAP
					is_russian_tag = yes
				}
				is_subject = no
			}
		}
	}
}

GER_has_military_governorate_puppet = {
	custom_trigger_tooltip = {
		tooltip = GER_owns_military_governorate_tt
		OR = {
			FRP = { GER_is_french_military_governorate_puppet = yes }
			GBP = { GER_is_british_military_governorate_puppet = yes }
		}
	}
}

GER_is_french_military_governorate_puppet = {
	is_subject_of = PREV
	has_cosmetic_tag = FRP_military_governorate
}

GER_is_british_military_governorate_puppet = {
	is_subject_of = PREV
	OR = {
		has_cosmetic_tag = GBP_military_governorate
		has_cosmetic_tag = GBP_england_military_governorate
	}
}

GER_is_military_governorate = {
	OR = {
		has_cosmetic_tag = FRP_military_governorate
		has_cosmetic_tag = GBP_military_governorate
		has_cosmetic_tag = GBP_england_military_governorate
	}
}
